<ng-container *ngIf="{
resultsAreLoading: resultsAreLoading$ | async,
candidateSearchFilter: candidateSearchFilter$ | async,
candidateSearchResults: candidateSearchResults$ | async,
totalCount: totalCount$ | async,
searchMailToLink: searchMailToLink$ | async,
selectedOccupationCodes: selectedOccupationCodes | async
} as observablesExpanded">

  <div #searchPanel
       class="container-fluid query-search-area pt-4 pt-lg-5 pb-4">
    <div class="form-row">
      <h2 class="sr-only">
        {{'portal.candidate-search.browser-title' | translate}}
      </h2>
      <alv-candidate-query-panel class="col-12 col-lg-9"
                                 (candidateQueryPanelValuesChange)="onQueryChange($event)"
                                 [showSpinner]="observablesExpanded.resultsAreLoading"
                                 [candidateQueryPanelValues]="observablesExpanded.candidateSearchFilter">
      </alv-candidate-query-panel>
      <div class="col-12 col-lg-2 col-lg-3 d-flex">
        <button (click)="onResetFilter()"
                class="reset-button btn btn-text h-100 mt-1 mt-lg-0 flex-grow-1 flex-lg-grow-0">
          {{ 'job-search.toolbar.reset' | translate }}
        </button>
      </div>


    </div>
  </div>

  <div (scrolled)="onScroll()"
       [fromRoot]="true"
       [infiniteScrollThrottle]="50"
       [immediateCheck]="true"
       class="container-fluid"
       infiniteScroll>

    <alv-three-column-layout [mobileOrdering]="[1, 3, 2]"
                             [stickyTop]="layoutConstants.STICKY_TOP_SEARCH + searchPanelHeight">
      <ng-container class="left-column">
        <div class="alv-bar mb-1">
          <span *ngIf="observablesExpanded.resultsAreLoading; else resultsCount">...</span>
          <ng-template #resultsCount>
            <strong>{{observablesExpanded.totalCount | number }} {{'portal.candidate-search.results-count.label' | translate}}</strong>
          </ng-template>
        </div>

        <h2 class="sr-only">
          {{'candidate-search.filter.title' | translate}}
        </h2>

        <alv-filter-panel (filterPanelValuesChange)="onFiltersChange($event)"
                          [filterPanelValues]="observablesExpanded.candidateSearchFilter"></alv-filter-panel>
      </ng-container>

      <ng-container class="main-column">
        <ng-container *ngIf="observablesExpanded.candidateSearchResults as candidateSearchResults">
          <alv-candidate-search-result *ngFor="let candidateSearchResult of candidateSearchResults"
                                       [selectedOccupationCodes]="observablesExpanded.selectedOccupationCodes"
                                       [candidateSearchResult]="candidateSearchResult">
          </alv-candidate-search-result>
          <div *ngIf="!candidateSearchResults.length">
            {{'global.common-phrases.no-results-found' | translate}}
          </div>
        </ng-container>

      </ng-container>

      <ng-container class="right-column">
        <div class="w-100 mb-3 text-right text-lg-left">
          <a *ngIf="observablesExpanded.searchMailToLink as searchMailToLink"
             class="btn btn-text btn-text-icon btn-truncate"
             [href]="searchMailToLink">
            <fa-icon class="mr-1"
                     [icon]="['fas', 'share']"></fa-icon>
            {{'candidate-search.filter.candidate-search-link' | translate}}
          </a>
        </div>
      </ng-container>

    </alv-three-column-layout>

  </div>
</ng-container>
